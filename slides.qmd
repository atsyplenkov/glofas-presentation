---
title: "Technical limitations and recommendations for streamflow predictions in data-scarce regions using <span style='color:#ffffff;'>GloFAS-ERA5</span>  reanalysis data"
subtitle: 'Anadyr River case study'
author: "<span style='color:#ffffff;'>Anatoly Tsyplenkov & Danila Shkolny<br><span style='font-size:80%'>Lomonosov Moscow State University</span></span>"
title-slide-attributes:
    data-background-image: assets/anadyr_overview_opacity.jpg
    data-background-size: cover
format:
  revealjs:
    math: katex
    theme: src/slides.scss
    footer: ''
    menu: false
    transition: fade
    progress: true
    multiplex: false
    preview-links: true
    scrollable: false
    hide-inactive-cursor: true
    highlight-style: printing
    pause: true
editor: source
knitr:
  opts_chunk:
    dev: "ragg_png"
    retina: 1
    dpi: 300
execute:
  freeze: auto
  cache: true
  echo: true
  fig-width: 9
  fig-height: 5.5
  fig-align: center
---

```{r}
#| label: setup
#| include: false
#| cache: false

source("src/plot-1.R")

```

## What does a boa constrictor that has eaten an elephant look like? {background-image="assets/boa-anadyr-1.png" background-size="cover" background-position="center"}

<!-- TODO: Add timer -->

## What does a boa constrictor that has eaten an elephant look like? {background-image="assets/boa-anadyr-2.png" background-size="cover" background-position="center"}

## Anadyr River is the largest ungauged Russian River

![](assets/anadyr_map.jpg){fig-align="center"}

<span style='font-size:50%; color:grey;'>*Alexander & Windom, 1999*</span>

## Anadyr River is the largest ungauged¬π Russian River

::: {.callout-note title = "Nota bene"}
**No streamflow measurements** on the state gauging station network in the last 30 years!
:::

![](assets/nothing.gif){fig-align="center"}

<span style='font-size:50%; color:grey;'>¬πno streamflow gages since 1996</span>

## Anadyr River is the largest ungauged¬π Russian River

:::::::: {.columns}
:::: {.column width="40%" align='left'}

{{<iconify mdi:question-mark-box>}} What can we do?

{{<iconify mdi:question-mark-box>}} How can we predict streamflow?

{{<iconify mdi:question-mark-box>}} How accurate are our predictions?

::::

:::: {.column width="60%" align='right'}

::::
::::::::

<span style='font-size:50%; color:grey;'>¬πno streamflow gages since 1996</span>

## Anadyr River is the largest ungauged¬π Russian River

:::::::: {.columns}
:::: {.column width="40%" align='left'}

{{<iconify mdi:question-mark-box>}} What can we do?

{{<iconify mdi:question-mark-box>}} How can we predict streamflow?

{{<iconify mdi:question-mark-box>}} How accurate are our predictions?

::::

:::: {.column width="60%" align='right'}
![](assets/iahs_pub.jpeg){width=40% fig-align="center"}

<div style="font-size:70%; text-align:center;"><b>We are probably late with this presentation for 10 years because IAHS PUB Decade was in 2003‚Äì2012...</b></div>

::::
::::::::

<span style='font-size:50%; color:grey;'>¬πno streamflow gages since 1996</span> 

## GloFAS-ERA5 quick overview

::: incremental
* Current version `GloFAS-ERA5 v4.0` (June 2025 release)

* Global hydrological models `HTESSEL`¬π and `LISFLOOD` v4.1.3

* Mean daily discharge in (`m¬≥/s`) at 0.05¬∞ spatial resolution (‚âà5 km) since 1980
:::

<span style='font-size:50%; color:grey;'>¬πHydrology Tiled ECMWF Scheme for Surface Exchanges over Land</span> 

## GloFAS-ERA5 calibration

Nearly `2,500` gauging stations used for calibration in `v4.0`. Global median `KGE'` is <b class="simple-highlight-1">0.7</b>

![](assets/glofas-map-1.png){width=80% fig-align="center"}

<span style='font-size:50%; color:grey;'>We are not affiliated with the ECMWF</span> 

## GloFAS-ERA5 calibration

Median `KGE'` for Chukotka and Kamchatka rivers ‚Äî <b class="simple-highlight-3">0.9-1.0</b>

![](assets/glofas-map-2.png){width=80% fig-align="center"}

<span style='font-size:50%; color:grey;'>We are not affiliated with the ECMWF</span>

## GloFAS-ERA5 calibration
![](assets/map_cv.png){fig-align="center"}

# Is it really that good?<br><br>üëÄ{background-color="#212121" transiton="zoom"}

## {#glofas-example}

```{r}
#| label: glofas-plot
#| echo: false
#| fig-align: center

ggiraph::girafe(
  ggobj = glofas_plot,
  width_svg = 8,
  height_svg = 6,
  options = list(
    ggiraph::opts_toolbar(saveaspng = FALSE),
    ggiraph::opts_sizing(width = .9),
    opts_tooltip(css = "font-family:Roboto"),
    opts_hover(
      css = "stroke-opacity:100%;fill-opacity:100%",
      nearest_distance = NULL
    )
  )
)

```

# KGE' = 0.53 {background-color="#212121" transiton="zoom"}

<center>
*¬´Doubtful, but okay...¬ª*¬©
</center>

![](assets/doubt.gif){fig-align="center"}

# Introducing ... bias-corrected hydrograph

## {#dqm-example}

```{r}
#| label: qmap-plot
#| echo: false
#| fig-align: center

ggiraph::girafe(
  ggobj = qmap_plot,
  width_svg = 8,
  height_svg = 6,
  options = list(
    ggiraph::opts_toolbar(saveaspng = FALSE),
    ggiraph::opts_sizing(width = .9),
    opts_tooltip(css = "font-family:Roboto"),
    opts_hover(
      css = "stroke-opacity:100%;fill-opacity:100%",
      nearest_distance = NULL
    )
  )
)

```

# KGE' = 0.86 {background-color="#212121" transiton="zoom"}

![](assets/cool.gif){fig-align="center"}

## Detrended Quantile Mapping (DQM)
![](assets/density1.png){fig-align="center"}

<span style='font-size:50%; color:grey;'>*Cannon et al., 2015*</span>

## Detrended Quantile Mapping (DQM)
![](assets/q1.png){fig-align="center"}

## Detrended Quantile Mapping (DQM)
![](assets/q2.png){fig-align="center"}

## Detrended Quantile Mapping (DQM)
![](assets/q3.png){fig-align="center"}

## Detrended Quantile Mapping (DQM)
![](assets/q4.png){fig-align="center"}

## Detrended Quantile Mapping (DQM)
![](assets/q5.png){fig-align="center"}

## Detrended Quantile Mapping (DQM)
![](assets/q10.png){fig-align="center"}

## How to choose optimal number of quantiles?
![](assets/cv-scheme-0.png){fig-align="center"}

## How to choose optimal number of quantiles?
![](assets/cv-scheme-1.png){fig-align="center"}

## How to choose optimal number of quantiles?
![](assets/cv-scheme-2.png){fig-align="center"}

## CV: Tanyurer‚ÄìTanyurer
![](assets/cv_plot_1587.png){fig-align="center"}

## CV: Mayn‚ÄìVaegi
![](assets/cv_plot_1504.png){fig-align="center"}

## 2021‚Äì2024 ADCP measurements
Comparision with recent measurements

# If I haven't convinced you yet... {transiton="zoom"}

# Koryakskaya River example (Kamchatka) <br><br> üåã {background-color="#212121" transiton="zoom"}

##
![](assets/koryaki_hydrograph.png){fig-align="center"}

##
![](assets/koryaki_scatterplot.png){fig-align="center"}

# Take home message <br><br> üè† {background-color="#212121" transiton="zoom"}

# Friends don't let friends use *uncorrected* <br> reanalysis data {background-color="#212121" transition="zoom"}

## Take home message v1.1

::: incremental
* `GloFAS-ERA5 v4.0` has potential for a bish-bash-bosh streamflow assessment

* Bias correction is necessary for `GloFAS-ERA5`

* Detrended Quantile Mapping can increase `GloFAS-ERA5` accuracy by 20‚Äì30%

* DQM is sensitive to the number of quantiles and requires tuning.
:::